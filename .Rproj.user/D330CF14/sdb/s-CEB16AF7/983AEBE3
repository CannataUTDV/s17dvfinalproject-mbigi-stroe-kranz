{
    "collab_server" : "",
    "contents" : "# server.R\nrequire(ggplot2)\nrequire(dplyr)\nrequire(shiny)\nrequire(shinydashboard)\nrequire(data.world)\nrequire(readr)\nrequire(DT)\nrequire(leaflet)\n\n\n\n\n\nshinyServer(function(input, output) { \n \n\n\n  \n  \n  df11 <- eventReactive(input$click1, {\n    \n      print(\"Getting from data.world\")\n      query(\n        data.world(propsfile = \"www/.data.world\"),\n        dataset=\"kurtakranz/s-17-dv-project-6\", type=\"sql\",\n        query= \"SELECT neighbourhood, room_type, avg(price) as average_price,\n        SUM(price) as sum_price, count(neighbourhood) as count_neighbourhood\n        \n        \n        \n        from clean_listings_summary\n        where room_type = 'Entire home/apt'\n        group by neighbourhood, room_type\n        order by neighbourhood\"\n      \n      ) \n    }\n)\n    \n  df12 <- eventReactive(input$click1, {\n    \n    print(\"Getting from data.world\")\n    query(\n      data.world(propsfile = \"www/.data.world\"),\n      dataset=\"kurtakranz/s-17-dv-project-6\", type=\"sql\",\n      query= \"SELECT neighbourhood, room_type, avg(price) as average_price,\n      SUM(price) as sum_price, count(neighbourhood) as count_neighbourhood\n      \n      \n      \n      from clean_listings_summary\n      where room_type = 'Private room'\n      group by neighbourhood, room_type\n      order by neighbourhood\"\n      \n    ) \n  }\n    )\n  \n  df13 <- eventReactive(input$click1, {\n    \n    print(\"Getting from data.world\")\n    query(\n      data.world(propsfile = \"www/.data.world\"),\n      dataset=\"kurtakranz/s-17-dv-project-6\", type=\"sql\",\n      query= \"SELECT neighbourhood, room_type, avg(price) as average_price,\n      SUM(price) as sum_price, count(neighbourhood) as count_neighbourhood\n      \n      \n      \n      from clean_listings_summary\n      where room_type = 'Shared room'\n      \n      group by neighbourhood, room_type\n      order by neighbourhood\"\n      \n    ) \n  }\n    )\n  \n  output$data1 <- renderDataTable({DT::datatable(df11(), rownames = FALSE,\n                  extensions = list(Responsive = TRUE, FixedHeader = TRUE)\n  )\n  })\n  \n  output$data2 <- renderDataTable({DT::datatable(df12(), rownames = FALSE,\n                                                 extensions = list(Responsive = TRUE, FixedHeader = TRUE)\n  )\n  })\n  \n  output$data3 <- renderDataTable({DT::datatable(df13(), rownames = FALSE,\n                                                 extensions = list(Responsive = TRUE, FixedHeader = TRUE)\n  )\n  })\n  \n  output$plot1 <- renderPlot({\n    ggplot(df11(), aes(x=factor(neighbourhood), y=average_price)) + geom_bar(stat = 'identity') + geom_hline(yintercept=365.8) + labs(title=\"Entire Room/Apt Prices\") + theme_light()\n  })\n  \n  output$plot2 <- renderPlot({\n    ggplot(df12(), aes(x=factor(neighbourhood), y=average_price)) + geom_bar(stat = 'identity') + geom_hline(yintercept=105) + labs(title=\"Private Room Prices\") + theme_light()\n  })\n  output$plot3 <- renderPlot({\n    ggplot(df13(), aes(x=factor(neighbourhood), y=average_price)) + geom_bar(stat = 'identity') + geom_hline(yintercept=87.9) + labs(title=\"Shared Room Prices\") + theme_light()\n  })\n\n\n  \n  df2 <- eventReactive(input$click2, {\n    \n    print(\"Getting from data.world\")\n    query(\n      data.world(propsfile = \"www/.data.world\"),\n      dataset=\"kurtakranz/s-17-dv-project-6\", type=\"sql\",\n      query= \"SELECT neighbourhood, avg(price) as average_price, (avg(price) - 249.7) as price_difference\n       \n        from clean_listings_summary\n        \n        group by neighbourhood\n        order by neighbourhood\"\n      \n    ) \n  }\n    )\n  \n  \n  output$barchartData1 <- renderDataTable({DT::datatable(df2(), rownames = FALSE,\n                         extensions = list(Responsive = TRUE, FixedHeader = TRUE)\n  )\n  })\n  \n  output$barchartPlot1 <- renderPlot({\n    ggplot(df2(), aes(x=factor(neighbourhood), y=price_difference)) + geom_bar(stat = 'identity')\n  })\n  \n  \n  df3 <- eventReactive(input$click3, {\n    \n    print(\"Getting from data.world\")\n    query(\n      data.world(propsfile = \"www/.data.world\"),\n      dataset=\"kurtakranz/s-17-dv-project-6\", type=\"sql\",\n      query= \"SELECT cast(l.neighbourhood as string), p.B05001_001 as population, avg(price) as             average_price\n      from clean_listings_summary l join \n      uscensusbureau.`acs-2015-5-e-foreignbirth`.`USA_ZCTA.csv/USA_ZCTA` p\n      on (l.neighbourhood = p.ZCTA)\n      group by l.neighbourhood\n      order by l.neighbourhood\"\n      \n    ) \n  }\n    )\n  \n  \n  output$barchartData2 <- renderDataTable({DT::datatable(df3(), rownames = FALSE,\n                                                         extensions = list(Responsive = TRUE, FixedHeader = TRUE)\n  )\n  })\n  \n  output$barchartPlot2 <- renderPlot({\n    ggplot(df3(), aes(x=factor(neighbourhood), y=population)) + geom_bar(stat = 'identity')\n  })\n\n  \n  \n  output$barchartPlot3 <- renderPlot({\n    ggplot(df3(), aes(x=factor(neighbourhood), y=average_price)) + geom_bar(stat = 'identity')\n  })\n\n} \n)",
    "created" : 1493607150315.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "376704969",
    "id" : "983AEBE3",
    "lastKnownWriteTime" : 1493079388,
    "last_content_update" : 1493079388,
    "path" : "~/CS329E/DataVisualization/s17dvfinalproject-mbigi-stroe-kranz/02 Shiny/Barcharts/server.R",
    "project_path" : "02 Shiny/Barcharts/server.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}